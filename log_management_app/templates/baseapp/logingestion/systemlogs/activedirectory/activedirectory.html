{% extends 'mainhome.html' %}
{% block content %}

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2 class="h3 mb-4 page-title">Windows Active Directory</h2>

            <div class="my-4">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="false">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" id="config-tab" data-toggle="tab" href="#config" role="tab" aria-controls="config" aria-selected="true">Configuration Details</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="alerts-tab" data-toggle="tab" href="#alerts" role="tab" aria-controls="alerts" aria-selected="false">Alerts & Anomalies</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" id="anomalies-tab" data-toggle="tab" href="#anomalies" role="tab" aria-controls="anomalies" aria-selected="false">Anomalies</a>
                    </li> -->
                    <li class="nav-item">
                        <a class="nav-link" id="version-history-tab" data-toggle="tab" href="#version-history" role="tab" aria-controls="version-history" aria-selected="false">Version History</a>
                    </li>
                </ul>
                

                <!-- Tab panes -->
                <div class="tab-content">
                    <!-- Overview Tab Content -->
                    <div class="tab-pane fade" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                        <h1 class="h3 page-title">About this integration</h1>
                        <hr class="my-2">
                        <p>The integration of Linux server monitoring for system logs and authentication logs is a critical component for 
                            ensuring server security and operational integrity. By leveraging logs from files such as /var/log/syslog 
                            and /var/log/auth.log, administrators can implement proactive alert systems that detect specific anomalies 
                            and potential threats. These logs provide granular details about system activities, including authentication 
                            attempts, service restarts, system performance, and user actions, allowing for real-time monitoring and response. <br> <br>

                            The integration highlights the importance of identifying specific events, such as multiple failed SSH login attempts, unauthorized 
                            root access, and kernel out-of-memory (OOM) killer activations. By categorizing these alerts into authentication and system-level 
                            events with varying severity levels, administrators can prioritize responses and mitigate risks. Furthermore, automated monitoring 
                            solutions, combined with this granular log analysis, enable businesses to adhere to compliance standards, reduce downtime, and enhance 
                            overall server resilience. This approach ensures that the Linux server remains secure and operates efficiently in the face of both internal 
                            and external challenges.
                        </p>                       
                    </div>

                    <!-- Configuration Details Tab Content -->
                    <div class="tab-pane fade show active" id="config" role="tabpanel" aria-labelledby="config-tab">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">

                                    
                                    <!-- Step 2: Download Script File -->
                                    <div class="card shadow mb-4">
                                        <div class="card-body">
                                            <h4>1. Download Script File</h4>
                                            <p class="mb-2"><strong>Before you configure this integration, you must set up the script</strong></p>                                            
                                            <button type="button" class="btn mb-2 btn-outline-success" data-toggle="modal" data-target="#verticalModal"> Setup Alloy </button>

                                            <div class="alert alert-info mt-3">
                                                <i class="fas fa-info-circle"></i>
                                                Looking to configure integrations for your Kubernetes environment? 
                                                Check out <a href="" target="_blank">Kubernetes Monitoring</a> 
                                                with LMAN Cloud to enable this.
                                            </div>
                                            <!-- Modal -->
                                            <div class="modal fade" id="verticalModal" tabindex="-1" role="dialog" aria-labelledby="verticalModalTitle" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                                                    <div class="modal-content" style="background-color: #181b1f; color: #ffffff;">
                                                        <!-- Header -->
                                                        <div class="modal-header border-0">
                                                            <h5 class="modal-title" id="verticalModalTitle">Alloy configuration</h5>
                                                            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                    
                                                        <!-- Modal Body -->
                                                        <div class="modal-body">
                                                            <!-- Step 1: Enter Token Name -->
                                                            <div id="step-1">
                                                                <h6>Install Alloy</h6>
                                                                <p>Use an API token</p>
                                                                <div class="form-group">
                                                                    <label for="token-name-input">Token name</label>
                                                                    <input id="token-name-input" type="text" class="form-control" placeholder="Enter a descriptive name to identify this token" />
                                                                </div>
                                                                <button id="create-token-btn" class="btn btn-primary">Create token</button>
                                                            </div>
                                    
                                                            <!-- Step 2: Display Generated Token -->
                                                            <div id="step-2" style="display: none;">
                                                                <h6>Install Alloy</h6>
                                                                <p style="color: #63bd83;">
                                                                    Below you find the token you just generated - no need to do anything with it, we’ve automatically added it to the script in the next step.
                                                                </p>
                                                                <div class="form-group">
                                                                    <label for="generated-token">Generated Token</label>
                                                                    <textarea id="generated-token" class="form-control" style="background-color: #111217; color: #ffffff;" readonly></textarea>
                                                                </div>                    
                                                            </div>
                                    
                                                            <!-- Step 3: Scrollable Command Section -->
                                                            <div id="step-3" style="display: none;">
                                                                <br>
                                                                <h3>Install and run Grafana Alloy</h3>
                                                                <p id="install-command-description">
                                                                    Run this command to install and run Alloy as a systemd service
                                                                </p>
                                                                <textarea id="command-textarea" class="form-control" style="background-color: #111217; color: #ffffff;" rows="3" readonly></textarea>
                                                                <button class="btn btn-secondary mt-2" id="copy-command-btn">Copy to clipboard</button>
                                                            </div>
                                    
                                                            <!-- Error Message -->
                                                            <div id="error-message" style="display: none; color: red;">
                                                                <p>Token has expired or invalid input! Please try again.</p>
                                                            </div>
                                                        </div>
                                    
                                                        <!-- Footer -->
                                                        <div class="modal-footer border-0">
                                                            <button class="btn btn-primary" id="test-connection-btn" style="display: none;">Test Alloy connection</button>
                                                            <button class="btn btn-success" id="proceed-install-btn" style="display: none;">Proceed to install integration</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                    
                                        </div> <!-- /.card-body -->
                                    </div> <!-- /.card -->
                                    
                                    <!-- JavaScript -->
                                    <script>
                                    function getCSRFToken() {
                                        let cookieValue = null;
                                        const cookies = document.cookie.split(';');
                                        for (let i = 0; i < cookies.length; i++) {
                                            const cookie = cookies[i].trim();
                                            if (cookie.startsWith('csrftoken=')) {
                                                cookieValue = cookie.substring('csrftoken='.length, cookie.length);
                                                break;
                                            }
                                        }
                                        return cookieValue;
                                    }
                                    
                                    document.getElementById("create-token-btn").addEventListener("click", function() {
                                        const tokenName = document.getElementById("token-name-input").value;
                                    
                                        if (!tokenName) {
                                            alert("Please enter a token name.");
                                            return;
                                        }
                                    
                                        fetch("/api/generate-token/", {
                                            method: "POST",
                                            headers: {
                                                "Content-Type": "application/json",
                                                "X-CSRFToken": getCSRFToken(),
                                            },
                                            body: JSON.stringify({ name: tokenName }),
                                        })
                                        .then(response => {
                                            if (!response.ok) throw new Error("Token generation failed!");
                                            return response.json();
                                        })
                                        .then(data => {
                                            const generatedToken = data.access_token;

                                            document.getElementById("step-1").style.display = "none";
                                            document.getElementById("step-2").style.display = "block";
                                            document.getElementById("generated-token").value = generatedToken;
                                            document.getElementById("step-3").style.display = "block";
                                            
                                            document.getElementById("install-command-description").innerText = "Run this command to install and run Alloy as a alloy.service systemd service:";
                                            document.getElementById("command-textarea").value = `curl -H "Authorization: Token ${generatedToken}" http://127.0.0.1:8000/execute/mark.sh`;

                                            document.getElementById("test-connection-btn").style.display = "inline-block";
                                            document.getElementById("proceed-install-btn").style.display = "inline-block";
                                        })
                                        .catch(error => {
                                            console.error("Error:", error);
                                            document.getElementById("error-message").style.display = "block";
                                        });
                                    });
                                    
                                    // Copy Command to Clipboard
                                    document.getElementById("copy-command-btn").addEventListener("click", function() {
                                        const commandField = document.getElementById("command-textarea");
                                        commandField.select();
                                        document.execCommand("copy");
                                        alert("Command copied to clipboard!");
                                    });
                                    
                                    // Close Modal on Proceed
                                    document.getElementById("proceed-install-btn").addEventListener("click", function() {
                                        $('#verticalModal').modal('hide');
                                    });
                                    </script>

                                    
                                    <!-- CSS -->
                                    <style>
                                        .modal-body textarea {
                                            background-color: #2c2f33;
                                            color: #ffffff;
                                            border: 1px solid #444;
                                        }
                                        .modal-content {
                                            border-radius: 8px;
                                        }
                                        .modal-footer button {
                                            margin-right: 10px;
                                        }
                                    </style>
                                    
                                    

<!-- Step 3: Create a Systemd Service File -->
<div class="card shadow mb-4" id="serviceFileSection">
    <div class="card-body">
        <h4>2. Create a Systemd Service File</h4>
        <p>Systemd services are configured using <code>.service</code> files. Follow these steps to create a service file for your script:</p>
        <ol>
            <li>Create a service file using the command below:</li>
            <div class="code-component" style="background-color: #111217; color: #ffffff; padding: 10px; border-radius: 8px; font-family: monospace;">
                <code>sudo nano /etc/systemd/system/log-collector.service</code>
            </div>
            <li>Add the following content to the service file:</li>
            <div class="code-component" style="background-color: #111217; color: #ffffff; padding: 10px; border-radius: 8px; font-family: monospace;">
                <pre style="color: white;">[Unit]
Description=Log Collector Service
After=network.target
            
[Service]
ExecStart=/usr/local/bin/collect-logs.sh
Restart=always
RestartSec=5s
User=root
Environment=LOG_API_URL="https://example.com/api/logs"
            
[Install]
WantedBy=multi-user.target</pre>
            </div>
            <li>Save and close the file.</li>
        </ol>
    </div> <!-- /.card-body -->
</div> <!-- /.card -->

<!-- JavaScript -->


<!-- Step 4: Reload Systemd and Enable the Service -->
<div class="card shadow mb-4" id="step4Card">
    <div class="card-body">
        <h4>3. Reload Systemd and Enable the Service</h4>
        <p>Reload the systemd configuration to recognize the new service and enable it to start on boot.</p>
        <ol id="step4Instructions">
            <li>Reload the systemd configuration using the command below:</li>
            <div class="code-component" style="background-color: #111217; color: #ffffff; padding: 10px; border-radius: 8px; font-family: monospace;">
                <code>sudo systemctl daemon-reload</code>
            </div>
            <li>Enable the service to start on boot:</li>
            <div class="code-component" style="background-color: #111217; color: #ffffff; padding: 10px; border-radius: 8px; font-family: monospace;">
                <code>sudo systemctl enable log-collector.service</code>
            </div>
            <li>Start the service using the command below:</li>
            <div class="code-component" style="background-color: #111217; color: #ffffff; padding: 10px; border-radius: 8px; font-family: monospace;">
                <code>sudo systemctl start log-collector.service</code>
            </div>
            <li>Check the service status to ensure it is running:</li>
            <div class="code-component" style="background-color: #111217; color: #ffffff; padding: 10px; border-radius: 8px; font-family: monospace;">
                <code>sudo systemctl status log-collector.service</code>
            </div>
        </ol>
    </div> <!-- /.card-body -->
</div> <!-- /.card -->



<!-- Step 5: Test Connection -->
<div class="card shadow mb-4">
    <div class="card-body">
        <h4>4. Test Connection</h4>
        <p class="mb-2">
            Test that Grafana Alloy is collecting data and sending it to Grafana Cloud.
        </p>

        <!-- Button to trigger connection test -->
        <button class="btn btn-primary" onclick="testConnection()">Test Connection</button>

        <!-- Alert for connection status (hidden initially) -->
        <div id="connectionStatus" class="alert alert-info mt-3" style="display: none;">
            <i class="fas fa-info-circle"></i>
            Connection Test Successful! Data is being sent to Grafana Cloud.
        </div>

        <div id="connectionError" class="alert alert-danger mt-3" style="display: none;">
            <i class="fas fa-exclamation-circle"></i>
            Connection Test Failed! Please check your settings.
        </div>
    </div> <!-- /.card-body -->
</div> <!-- /.card -->

<!-- Step 6: Test Connection -->
<div id="step-6">
    <h4>View Connection</h4>
    <p>
        This integration comes with pre-built dashboards, alerts to get you up and running quickly.
    </p>
    <button class="btn btn-primary">View Connection</button> <br> <br>
</div>   

                                </div> <!-- /.col-md-12 -->
                            </div> <!-- /.row -->
                        </div> <!-- /.container -->
                    </div> <!-- /.tab-pane -->

                    <div class="tab-pane fade" id="alerts" role="tabpanel" aria-labelledby="alerts-tab">
                        <h1 class="h3 page-title">Alerts & Anomalies</h1>
                        <hr class="my-2">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Alert Name</th>
                                    <th>Event ID</th>
                                    <th>Category</th>
                                    <th>Level</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Successful Logon</td>
                                    <td>4624</td>
                                    <td>Authentication</td>
                                    <td>High</td>
                                    <td>This event indicates a successful logon to the system, typically a user successfully logging into the domain.</td>
                                </tr>
                                <tr>
                                    <td>Failed Logon</td>
                                    <td>4625</td>
                                    <td>Authentication</td>
                                    <td>High</td>
                                    <td>This event records a failed logon attempt. It is essential for detecting potential brute-force attacks or misconfigured credentials.</td>
                                </tr>
                                <tr>
                                    <td>Account Locked Out</td>
                                    <td>4740</td>
                                    <td>Authentication</td>
                                    <td>High</td>
                                    <td>This event occurs when a user account is locked due to too many failed login attempts. It can indicate potential brute-force attacks.</td>
                                </tr>
                                <tr>
                                    <td>User Account Created</td>
                                    <td>4720</td>
                                    <td>Authentication</td>
                                    <td>Medium</td>
                                    <td>This event shows when a new user account is created in Active Directory. It's useful for monitoring administrative changes.</td>
                                </tr>
                                <tr>
                                    <td>A Member Was Added to a Security-Enabled Local Group</td>
                                    <td>4732</td>
                                    <td>Authentication</td>
                                    <td>High</td>
                                    <td>This event is logged when a user is added to a privileged group, which could indicate unauthorized access or privilege escalation.</td>
                                </tr>
                                <tr>
                                    <td>A User Account Was Unlocked</td>
                                    <td>4767</td>
                                    <td>Authentication</td>
                                    <td>Medium</td>
                                    <td>This event indicates when a previously locked-out account is unlocked, which could indicate user recovery or malicious activity.</td>
                                </tr>
                                <tr>
                                    <td>The Name of an Account Was Changed</td>
                                    <td>4781</td>
                                    <td>Authentication</td>
                                    <td>Medium</td>
                                    <td>This event logs when a user’s account name is changed. This could indicate attempts to obfuscate a user’s identity.</td>
                                </tr>
                                <tr>
                                    <td>A User’s Local Group Membership Was Enumerated</td>
                                    <td>4798</td>
                                    <td>Authentication</td>
                                    <td>Medium</td>
                                    <td>This event is logged when a user’s group membership is queried, which may indicate reconnaissance or attack attempts.</td>
                                </tr>
                                <tr>
                                    <td>The Windows Filtering Platform has permitted a connection</td>
                                    <td>5156</td>
                                    <td>Network</td>
                                    <td>High</td>
                                    <td>This event can show when network traffic is allowed by the firewall, potentially helping to identify unauthorized network access.</td>
                                </tr>
                                <tr>
                                    <td>A Logon Attempt Was Made Using Explicit Credentials</td>
                                    <td>4648</td>
                                    <td>Authentication</td>
                                    <td>Medium</td>
                                    <td>This event indicates a logon attempt using explicit credentials, such as when a user logs on with alternate credentials. It could be suspicious if it happens unexpectedly.</td>
                                </tr>
                                <tr>
                                    <td>Permissions on an Object Were Changed</td>
                                    <td>4670</td>
                                    <td>Authentication</td>
                                    <td>High</td>
                                    <td>This event shows when permissions on an object in Active Directory (like a user or group) were changed, which can indicate a potential security breach or unauthorized privilege escalation.</td>
                                </tr>
                                <tr>
                                    <td>A User Account Was Changed</td>
                                    <td>4738</td>
                                    <td>Authentication</td>
                                    <td>Medium</td>
                                    <td>This event indicates when a user’s attributes (e.g., password, group membership) are changed. Unusual changes should be investigated for signs of malicious activity.</td>
                                </tr>
                                <tr>
                                    <td>A Service Ticket Was Requested</td>
                                    <td>4769</td>
                                    <td>Authentication</td>
                                    <td>Medium</td>
                                    <td>This event is logged when a service ticket is requested from the Kerberos Key Distribution Center (KDC). Monitoring these events helps identify potential service account misuse.</td>
                                </tr>
                                <tr>
                                    <td>A User Account Was Deleted</td>
                                    <td>4726</td>
                                    <td>Authentication</td>
                                    <td>High</td>
                                    <td>This event logs when a user account is deleted in Active Directory. It’s important for detecting unauthorized account deletions or suspicious activity.</td>
                                </tr>
                                <tr>
                                    <td>A Privileged Service Was Called</td>
                                    <td>4673</td>
                                    <td>Authentication</td>
                                    <td>High</td>
                                    <td>This event indicates that a privileged service, such as a system-level service, was called. This could indicate a potentially malicious attempt to interact with sensitive services.</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        
                    </div>
                    
                    
                

                    <!-- Version History Tab Content -->
                    <div class="tab-pane fade" id="version-history" role="tabpanel" aria-labelledby="version-history-tab">
                        <h1 class="h3 page-title">Version History</h1>
                        <hr class="my-2"> <br>
                        <h4>VERSION 1.0</h4>
                    </div>
                </div>
            </div> <!-- /.my-4 -->
        </div> <!-- /.col-12 -->
    </div> <!-- .row -->
</div> <!-- .container -->

{% endblock %}
